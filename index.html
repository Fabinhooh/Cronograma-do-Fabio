<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Cronograma do FÃ¡bio</title>
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cronograma">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230f172a'/><text y='65' x='50' font-size='50' text-anchor='middle'>âœ¨</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230f172a'/><text y='65' x='50' font-size='50' text-anchor='middle'>âœ¨</text></svg>">

    <style>
        :root {
            --bg-body: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --border-color: #e2e8f0;
            --today-bg: #fefce8;
            --today-border: #facc15;
            
            /* Cores das Tarefas */
            --color-box: #f59e0b;
            --color-barba: #10b981;
            --color-umid: #3b82f6;
            --color-ar: #ef4444;
            --color-sec-lavar: #db2777;
            --color-asp-lavar: #8b5cf6;
            --color-sec-mao: #06b6d4;
            --color-asp-pincel: #78350f;
        }

        /* VariÃ¡veis Modo Escuro */
        [data-theme="dark"] {
            --bg-body: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --border-color: #334155;
            --today-bg: #1e293b;
            --today-border: #facc15;
        }

        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; transition: background 0.3s, color 0.3s; }
        
        /* Ajuste para evitar "pulo" ao rolar no celular como app */
        html, body { overscroll-behavior-y: none; }
        body { background: var(--bg-body); color: var(--text-main); margin: 0; padding: 15px; padding-top: 25px; }
        
        .container { max-width: 1200px; margin: auto; }

        /* BotÃ£o Dark Mode */
        .theme-toggle {
            position: absolute; top: 20px; right: 20px; z-index: 2000;
            background: var(--card-bg); border: 1px solid var(--border-color);
            padding: 10px; border-radius: 50%; cursor: pointer; font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
        }

        /* Painel de Status */
        .status-panel {
            background: white; padding: 25px; border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 25px;
            border-left: 8px solid #64748b; margin-top: 15px;
        }
        [data-theme="dark"] .status-panel { background: #1e293b; }
        .status-panel.is-today { border-left-color: var(--color-barba); background: #f0fdf4; }
        [data-theme="dark"] .status-panel.is-today { background: #064e3b; color: white; }
        
        .status-title { font-size: 0.8rem; font-weight: 800; text-transform: uppercase; color: var(--text-sub); letter-spacing: 0.05em; margin-bottom: 8px; }
        .status-content { font-size: 1.2rem; font-weight: 700; }

        header { padding: 20px; text-align: center; margin-bottom: 20px; position: relative; }
        .controles { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px; }
        
        input, select { 
            padding: 8px 12px; border-radius: 10px; border: 2px solid var(--border-color); 
            font-size: 0.95rem; font-weight: bold; outline: none; background: var(--card-bg); color: var(--text-main);
        }

        /* Grid de Meses */
        .grid-meses { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; padding-bottom: 40px; }
        .mes-card { background: var(--card-bg); border-radius: 24px; padding: 18px; border: 1px solid var(--border-color); }
        .mes-titulo { font-size: 1.1rem; font-weight: 800; text-transform: capitalize; margin-bottom: 15px; color: var(--text-main); }

        /* Tags */
        .tag { font-size: 0.6rem; padding: 3px 7px; border-radius: 6px; color: white; font-weight: 700; margin-right: 3px; margin-bottom: 3px; display: inline-block; text-transform: uppercase; }
        .tag-box { background: var(--color-box); } .tag-barba { background: var(--color-barba); }
        .tag-umid { background: var(--color-umid); } .tag-ar { background: var(--color-ar); }
        .tag-sec-lavar { background: var(--color-sec-lavar); } .tag-asp-lavar { background: var(--color-asp-lavar); }
        .tag-sec-mao { background: var(--color-sec-mao); } .tag-asp-pincel { background: var(--color-asp-pincel); }

        /* Lista */
        .item-lista { display: flex; padding: 12px; border-radius: 14px; margin-bottom: 8px; background: var(--card-bg); border: 1px solid var(--border-color); gap: 12px; align-items: center; position: relative; }
        .item-lista.is-today-row { background: var(--today-bg); border: 2px solid var(--today-border); }
        .badge-hoje { position: absolute; right: 10px; top: -8px; background: var(--today-border); color: #854d0e; font-size: 0.55rem; font-weight: 900; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
        
        .data-extenso { min-width: 100px; font-size: 0.7rem; color: var(--text-sub); }
        .data-extenso b { display: block; font-size: 1rem; color: var(--text-main); }

        /* CalendÃ¡rio Moderno (Contraste Escuro) */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-dia { 
            aspect-ratio: 1; border-radius: 10px; font-size: 0.75rem; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid var(--border-color); cursor: pointer; background: #334155; color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
        }
        .cal-dia.has-task { background: #1e293b; color: white; font-weight: 700; }
        .cal-dia.is-today-cal { background: var(--today-bg); border: 2px solid var(--today-border); color: #854d0e; }
        
        .dot-container { display: flex; flex-wrap: wrap; gap: 1.5px; justify-content: center; margin-top: 2px; }
        .dot { width: 4.5px; height: 4.5px; border-radius: 50%; }

        /* Modal */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
        .modal-content { background: var(--card-bg); color: var(--text-main); padding: 30px; border-radius: 28px; max-width: 400px; width: 100%; position: relative; }
        .close-btn { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.2rem; }

        @media (max-width: 600px) { .grid-meses { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <button class="theme-toggle" onclick="toggleTheme()" id="themeIcon">ðŸŒ™</button>
        <h1 style="font-size: 1.5rem; margin:0; padding-top: 10px;">Cronograma do FÃ¡bio</h1>
        <div class="controles">
            <input type="number" id="anoInput" value="2026" oninput="render()">
            <select id="viewSelect" onchange="render()">
                <option value="tabela">Lista</option>
                <option value="calendario">CalendÃ¡rio</option>
            </select>
        </div>
    </header>

    <div id="statusPanel" class="status-panel">
        <div class="status-title" id="statusLabel">Status</div>
        <div class="status-content" id="statusTask"></div>
    </div>

    <div id="calendarioContainer" class="grid-meses"></div>
</div>

<div id="modal" onclick="closeModal()"><div class="modal-content" onclick="event.stopPropagation()"><span class="close-btn" onclick="closeModal()">âœ•</span><div id="modalBody"></div></div></div>

<script>
    // Inicializa a preferÃªncia de tema salva (se houver)
    if(localStorage.getItem('temaFabio') === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.getElementById('themeIcon').innerText = 'â˜€ï¸';
    }

    const MARCO_ZERO = new Date(2026, 1, 13);
    const HOJE = new Date(); 
    HOJE.setHours(0,0,0,0);

    const CORES = {
        'Box': 'var(--color-box)', 'Barba': 'var(--color-barba)', 'Umidificador': 'var(--color-umid)',
        'Filtro Ar': 'var(--color-ar)', 'Secadora Lavar': 'var(--color-sec-lavar)', 
        'Aspirador Lavar': 'var(--color-asp-lavar)', 'Secadora MÃ£o': 'var(--color-sec-mao)', 'Aspirador Pincel': 'var(--color-asp-pincel)'
    };

    function toggleTheme() {
        const doc = document.documentElement;
        const currentTheme = doc.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        doc.setAttribute('data-theme', newTheme);
        document.getElementById('themeIcon').innerText = newTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        localStorage.setItem('temaFabio', newTheme); // Salva a preferÃªncia
    }

    function getTarefa(data) {
        const d1 = new Date(MARCO_ZERO.getFullYear(), MARCO_ZERO.getMonth(), MARCO_ZERO.getDate());
        const d2 = new Date(data.getFullYear(), data.getMonth(), data.getDate());
        const diff = Math.round((d2 - d1) / 86400000);
        if (diff % 4 !== 0) return null;

        const numEvento = diff / 4;
        const tipo = (((numEvento % 2) + 2) % 2) === 0 ? "Box" : "Barba";
        let tags = [{txt: tipo, cl: `tag-${tipo.toLowerCase()}`}];

        const dAnt = new Date(data); dAnt.setDate(data.getDate() - 4);
        if (data.getDate() >= 13 && (dAnt.getMonth() !== data.getMonth() || dAnt.getDate() < 13)) tags.push({txt: "Filtro Ar", cl: "tag-ar"});
        if (((numEvento - 3) % 4 + 4) % 4 === 0) tags.push({txt: "Umidificador", cl: "tag-umid"});

        if (tipo === "Barba") {
            const nB = Math.floor(numEvento / 2) + 1;
            const cB = ((nB % 4) + 4) % 4;
            if (cB === 0) tags.push({txt: "Secadora Lavar", cl: "tag-sec-lavar"}, {txt: "Aspirador Lavar", cl: "tag-asp-lavar"});
            else if (cB === 2) tags.push({txt: "Secadora Lavar", cl: "tag-sec-lavar"}, {txt: "Aspirador Pincel", cl: "tag-asp-pincel"});
            else tags.push({txt: "Secadora MÃ£o", cl: "tag-sec-mao"}, {txt: "Aspirador Pincel", cl: "tag-asp-pincel"});
        }
        return { tipo, tags, dFmt: data.toLocaleDateString('pt-br', {weekday:'long', day:'2-digit', month:'2-digit', year:'numeric'}) };
    }

    function atualizarStatus() {
        const infoHoje = getTarefa(HOJE);
        const panel = document.getElementById('statusPanel');
        const label = document.getElementById('statusLabel');
        const content = document.getElementById('statusTask');

        if (infoHoje) {
            panel.classList.add('is-today');
            label.innerText = "âœ¨ Hoje Ã© dia das tarefas (" + infoHoje.dFmt + "):";
            content.innerHTML = infoHoje.tags.map(t => `<span class="tag ${t.cl}">${t.txt}</span>`).join(' ');
        } else {
            panel.classList.remove('is-today');
            let busca = new Date(HOJE);
            for(let i=1; i<=4; i++) {
                busca.setDate(busca.getDate() + 1);
                let prox = getTarefa(busca);
                if(prox) {
                    label.innerText = "â­ï¸ PrÃ³ximas tarefas (" + prox.dFmt + "):";
                    content.innerHTML = prox.tags.map(t => `<span class="tag ${t.cl}">${t.txt}</span>`).join(' ');
                    break;
                }
            }
        }
    }

    function render() {
        // Pega o ano da input, ou define pro ano atual se a input estiver vazia
        const inputAno = document.getElementById('anoInput');
        if(!inputAno.value) inputAno.value = HOJE.getFullYear();
        const ano = parseInt(inputAno.value);
        
        const view = document.getElementById('viewSelect').value;
        const container = document.getElementById('calendarioContainer');
        if(!ano) return;
        container.innerHTML = '';
        atualizarStatus();

        for(let m=0; m<12; m++) {
            const card = document.createElement('div');
            card.className = 'mes-card';
            const nomeMes = new Date(ano, m, 1).toLocaleString('pt-br', {month:'long'});
            let html = `<div class="mes-titulo">${nomeMes}</div>`;

            if(view === 'tabela') {
                for(let d=1; d<=new Date(ano, m+1, 0).getDate(); d++) {
                    const dataIter = new Date(ano, m, d);
                    const info = getTarefa(dataIter);
                    if(info) {
                        const isToday = dataIter.getTime() === HOJE.getTime();
                        html += `<div class="item-lista ${isToday ? 'is-today-row' : ''}">
                            ${isToday ? '<span class="badge-hoje">Hoje</span>' : ''}
                            <div class="data-extenso"><b>${d}</b> ${dataIter.toLocaleString('pt-br', {weekday:'short'})}</div>
                            <div>${info.tags.map(t => `<span class="tag ${t.cl}">${t.txt}</span>`).join('')}</div>
                        </div>`;
                    }
                }
            } else {
                html += `<div class="cal-grid">`;
                ['D','S','T','Q','Q','S','S'].forEach(d => html += `<div style="font-size:0.6rem; text-align:center; color:#94a3b8; font-weight:800; padding-bottom:5px">${d}</div>`);
                const prim = new Date(ano, m, 1).getDay();
                for(let i=0; i<prim; i++) html += `<div></div>`;
                for(let d=1; d<=new Date(ano, m+1, 0).getDate(); d++) {
                    const dataIter = new Date(ano, m, d);
                    const info = getTarefa(dataIter);
                    const isToday = dataIter.getTime() === HOJE.getTime();
                    html += `<div class="cal-dia ${info ? 'has-task' : ''} ${isToday ? 'is-today-cal' : ''}" onclick="openModal(${d},${m},${ano})">
                        ${d}
                        <div class="dot-container">${info ? info.tags.map(t => `<div class="dot" style="background:${CORES[t.txt]}"></div>`).join('') : ''}</div>
                    </div>`;
                }
                html += `</div>`;
            }
            card.innerHTML = html; container.appendChild(card);
        }
    }

    function openModal(d,m,a) {
        const info = getTarefa(new Date(a,m,d));
        if(!info) return;
        document.getElementById('modalBody').innerHTML = `<h3 style="margin:0 0 15px 0; font-size:1.1rem; text-transform:capitalize">${info.dFmt}</h3>${info.tags.map(t => `<span class="tag ${t.cl}" style="font-size:0.75rem; padding:5px 10px">${t.txt}</span>`).join('')}`;
        document.getElementById('modal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    window.onload = render;
</script>
</body>
</html>